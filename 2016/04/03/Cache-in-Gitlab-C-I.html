<!DOCTYPE html>
<html>
  <head>
    <title>Cache in Gitlab CI</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    
    <link rel="apple-touch-icon" sizes="57x57" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/apple-touch-icon-57x57.png?v=wAAv6Wqe6l?v=1490383841467">
    <link rel="apple-touch-icon" sizes="60x60" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/apple-touch-icon-60x60.png?v=wAAv6Wqe6l?v=1490383841467">
    <link rel="apple-touch-icon" sizes="72x72" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/apple-touch-icon-72x72.png?v=wAAv6Wqe6l?v=1490383841467">
    <link rel="apple-touch-icon" sizes="76x76" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/apple-touch-icon-76x76.png?v=wAAv6Wqe6l?v=1490383841467">
    <link rel="apple-touch-icon" sizes="114x114" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/apple-touch-icon-114x114.png?v=wAAv6Wqe6l?v=1490383841467">
    <link rel="apple-touch-icon" sizes="120x120" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/apple-touch-icon-120x120.png?v=wAAv6Wqe6l?v=1490383841467">
    <link rel="apple-touch-icon" sizes="144x144" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/apple-touch-icon-144x144.png?v=wAAv6Wqe6l?v=1490383841467">
    <link rel="apple-touch-icon" sizes="152x152" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/apple-touch-icon-152x152.png?v=wAAv6Wqe6l?v=1490383841467">
    <link rel="apple-touch-icon" sizes="180x180" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/apple-touch-icon-180x180.png?v=wAAv6Wqe6l?v=1490383841467">
    <link rel="icon" type="image/png" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/favicon-32x32.png?v=wAAv6Wqe6l?v=1490383841467" sizes="32x32">
    <link rel="icon" type="image/png" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/favicon-194x194.png?v=wAAv6Wqe6l?v=1490383841467" sizes="194x194">
    <link rel="icon" type="image/png" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/favicon-96x96.png?v=wAAv6Wqe6l?v=1490383841467" sizes="96x96">
    <link rel="icon" type="image/png" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/android-chrome-192x192.png?v=wAAv6Wqe6l?v=1490383841467" sizes="192x192">
    <link rel="icon" type="image/png" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/favicon-16x16.png?v=wAAv6Wqe6l?v=1490383841467" sizes="16x16">
    <link rel="manifest" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/manifest.json?v=wAAv6Wqe6l?v=1490383841467">
    <link rel="shortcut icon" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/favicon.ico?v=wAAv6Wqe6l?v=1490383841467">
    <meta name="msapplication-TileColor" content="#e74c3c">
    <meta name="msapplication-TileImage" content="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/mstile-144x144.png?v=wAAv6Wqe6l?v=1490383841467">
    <meta name="msapplication-config" content="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/img/browserconfig.xml?v=wAAv6Wqe6l?v=1490383841467">
    <meta name="theme-color" content="#e74c3c">
    <link rel="stylesheet" type="text/css" href="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/css/uno-zen.css?v=1490383841467" />
    <link rel="canonical" href="https://atomfrede.github.io/shiny-adventure/2016/04/03/Cache-in-Gitlab-C-I.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Shiny Adventures" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Cache in Gitlab CI" />
    <meta property="og:description" content="When using gitlab ci one might know the cache property. With defining cached files these are used for subsequent build (instead of downloading them again). This is extremly useful when using a docker executor, the shell executor doesn&amp;#8217;t need a cache as long as a build doesn&amp;#8217;" />
    <meta property="og:url" content="https://atomfrede.github.io/shiny-adventure/2016/04/03/Cache-in-Gitlab-C-I.html" />
    <meta property="article:published_time" content="2016-04-03T00:00:00.000Z" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Cache in Gitlab CI" />
    <meta name="twitter:description" content="When using gitlab ci one might know the cache property. With defining cached files these are used for subsequent build (instead of downloading them again). This is extremly useful when using a docker executor, the shell executor doesn&amp;#8217;t need a cache as long as a build doesn&amp;#8217;" />
    <meta name="twitter:url" content="https://atomfrede.github.io/shiny-adventure/2016/04/03/Cache-in-Gitlab-C-I.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Shiny Adventures",
    "author": {
        "@type": "Person",
        "name": "Frederik Hahne",
        "image": "https://avatars1.githubusercontent.com/u/203401?v=3",
        "url": "https://atomfrede.github.io/shiny-adventure/author/atomfrede/",
        "sameAs": "http://atomfrede.github.com/shiny-adventure/"
    },
    "headline": "Cache in Gitlab CI",
    "url": "https://atomfrede.github.io/shiny-adventure/2016/04/03/Cache-in-Gitlab-C-I.html",
    "datePublished": "2016-04-03T00:00:00.000Z",
    "description": "When using gitlab ci one might know the cache property. With defining cached files these are used for subsequent build (instead of downloading them again). This is extremly useful when using a docker executor, the shell executor doesn&amp;#8217;t need a cache as long as a build doesn&amp;#8217;"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Shiny Adventures" href="https://atomfrede.github.io/shiny-adventure/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-dark.min.css">
  </head>
  <body class="post-template">
    <header id="menu-button" class="expanded">
      <a><i class="icon icon-list"></i></a>
    </header>
    <aside class="cover" style="background: url() center/cover no-repeat fixed">
      <div class="cover container">
        <div class="profile">
          <a id="avatar-link" title="link to homepage for Shiny Adventures" href="https://atomfrede.github.io/shiny-adventure/#open">
            <img src="https://avatars2.githubusercontent.com/u/203401?v&#x3D;3&amp;s&#x3D;460" alt="Shiny Adventures avatar" class="profile avatar rounded hvr-buzz-out" />
            <h1 id="profile-title">Shiny Adventures</h1>
            <h3 id="profile-resume"></h3>
          </a>
    
          <hr class="divider long" />
          <p>Of a former computer science student, now nerd and jhipster </p>
          <hr class="divider short" />
          <div class="navigation">
            <div class="profile contact">
              
              <nav class="navigation right">
                <ul class="social expanded">
              
                  <!-- Twitter -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://www.facebook.com/frederik.hahne" title="Facebook account">
                      <i class='icon icon-social-facebook'></i>
                      <span class="label">Facebook</span>
                    </a>
                  </li>
              
                  <!-- Twitter -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://twitter.com/atomfrede" title="Twitter account">
                      <i class='icon icon-social-twitter'></i>
                      <span class="label">Twitter</span>
                    </a>
                  </li>
              
                  <!-- Google Plus -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://plus.google.com/+FrederikHahne" title="Google+ account">
                      <i class='icon icon-social-google-plus'></i>
                      <span class="label">Google-plus</span>
                    </a>
                  </li>
              
                  <!-- Github -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="https://github.com/atomfrede" title="Github account">
                      <i class='icon icon-social-github'></i>
                      <span class="label">Github</span>
                    </a>
                  </li>
                  </li>
              
              
              
              
                  <!-- LinkedIn -->
                  <li class="social item hvr-grow-rotate">
                    <a rel="me" href="http://de.linkedin.com/in/frederikhahne" title="LinkedIn account">
                      <i class='icon icon-social-linkedin'></i>
                      <span class="label">LinkedIn</span>
                    </a>
                  </li>
              
              
                </ul>
              </nav>
              <!-- <section class="icon icon-search" id="search-container">
      <hr class="divider short" />
      <form id="search-form">
        <input type="text", name="search", placeholder="git, css, javascript,..." id="search-field" />
      </form>
    </section>
     -->
            </div>
          </div>
        </div>
      </div>
    </aside>
    <main>
      <section id="search-results"></section>
      <section class="content">
        

  <article class="post">
    <header>
      <div class="post meta">
        <time datetime="03 Apr 2016">03 Apr 2016</time>
        <span class="post tags"></span>


        <span class="post reading-time"> ~ <span></span> read.</span>
      </div>
      <a alt="Tweet 'Cache in Gitlab CI'" href="https://twitter.com/intent/tweet?text=Cache%20in%20Gitlab%20CI%20%C2%BB&amp;hashtags=&amp;url=https://atomfrede.github.io/shiny-adventure/">
        
        <h1 class="icon-reverse icon-social-twitter-post" id="post-title">Cache in Gitlab CI</h1>
      </a>
    </header>

    <div id="post-content" class="post">
      <div class="paragraph">
<p>When using <a href="http://doc.gitlab.com/ce/ci/yaml/README.html">gitlab ci</a> one might know the cache property. With defining cached files these are used for subsequent build (instead of downloading them again). This is extremly useful when using a docker executor, the shell executor doesn&#8217;t need a cache as long as a build doesn&#8217;t remove downloaded or generated artifacts.</p>
</div>
<div class="paragraph">
<p>But the build can only cache artifacts in the <a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/issues/327:">current working directory</a>, so you can&#8217;t cache e.g. the local <code>.m2</code> folder in order to avoid downloading artifacts every build. Furthermore <strong>everything</strong> inside the <code>/cache</code> folder is automatically cached by the ci runner.</p>
</div>
<div class="paragraph">
<p>Therefore if we could make maven download its artifacts to <code>/cache/.m2</code> instead of <code>${USER_HOME}/.m2</code> all downloaded artifacts will be cached. This can be done by providing <code>-Dmaven.repo.local</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">image: java
stages:
  - build
mvn-package:
  stage: build
  script: "./mvnw package -Dmaven.repo.local=/cache"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When executing the build a second time it doesn&#8217;t download all artifacts anymore, only changed ones.
For me as a huge gradle fan I needed cache for gradle dependencies as well. This is also very easy and even caches the downloaed <code>gradle wrapper</code> for subsequent builds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">image: java
stages:
  - build
gradle-assemble:
  stage: build
  script: "./gradlew -g /cache assemble"</code></pre>
</div>
</div>
    </div>

    <div class="post related">

    </div>

    <footer class="post comments">
    </footer>

  </article>


        <footer>
          <span class="copyright">
            &copy; 2017. All rights reserved. Built with <a href="https://github.com/Kikobeats/uno-zen" target="_blank">Uno Zen</a> under <a href="http://hubpress.io/" target="_blank">HubPress</a>.
          </span>
        </footer>
      </section>
    </main>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>
       
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
    <script src="//atomfrede.github.io/shiny-adventure/themes/uno-zen/assets/js/uno-zen.js?v=1490383841467" type="text/javascript" charset="utf-8"></script>
  </body>
</html>
